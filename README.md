# circulation_snRNA-Seq_code
Scripts used for the integration and analysis of single nuclear RNA-Seq samples from Alex et al. [PMID: 37350296](https://pubmed.ncbi.nlm.nih.gov/37350296/) 

## Bioinformatics Methods

After running `CellRanger` software (v7.0.1; 10X Genomics) obtained count matrices were filtered and analyzed by the `RISC` package (v1.6) for each of the five samples and their integration. Cells with a UMI count between 1,000 to 10,000, > 2,000 genes, and < 10% of mitochondrial gene reads were kept for further analysis. `DoubletFinder` package was used to identify and remove doublets from each dataset. Data integration was performed by RISC function scMultiIntegrate using the infarcted sample #1 as the reference and the top 20 principal components (PCs). Dimensionality reduction was performed using integrated cell-eigenvectors and clustering using scCluster (default parameters). A small cell cluster consisting of 31 cells from all five samples was very distinct from the other clusters but without clear markers and thus was removed. Gene markers for each cluster were identified using AllMarker function and Wilcoxon Rank Sum test. Differential expression (DE) analysis between Infarcted hearts and controls was first run by comparing all the cells from the infarcted samples and all the cells from the control samples by Wilcoxon test, using the scDEG function (adjusted p (padj) < 0.05). Because this method can lead to over estimation of DE genes, we also performed a pseudo-bulk DE analysis using `edgeR` package with default parameters, after aggregating reads from cells in each cluster from the same biological replicate. Statistical significance was also set as padj < 0.05. Script for this analysis is [snRNA-seq_CODE_Circulation.Rmd](https://github.com/mastorkia/circulation_snRNA-Seq_code/blob/main/analysis_scripts/snRNA-seq_CODE_Circulation.Rmd).


Spliced/unspliced read count matrix for the infarcted sample (#1) was generated by `velocyto` (v0.17.17). The resulted loom file was further processed by `scVelo` (v0.2.4) to compute and visualize the proportions of spliced/unspliced reads for each of the cell clusters. Variable genes were detected by minimum number of counts and dispersion, and counts were normalized by total library size and logarithmized using the pp.filter and_normalize functions with default parameters. Mean and variance of the data were calculated by nearest neighbors in PCA space using 30 PCs and 30 neighbors. The estimation of RNA velocity was obtained by tl.velocity and tl.velocity_graph functions using default parameters, while projection of RNA velocity to the UMAP was obtained from a dynamic function (tl.umap) and together with the RISC clustering. Script for this analysis is [velocity_analysis.ipynb](https://github.com/mastorkia/circulation_snRNA-Seq_code/blob/main/analysis_scripts/velocity_analysis.ipynb).


## References
- **CellRanger**: Zheng, Grace X.Y., Terry, Jessica M., [...] Bielas, Jason H. (2017). Massively parallel digital transcriptional profiling of single cells. Nature Communications. 8: 1-12, doi:10.1038/ncomms14049.
- **RISC**: Liu, Y, Wang, T, Zhou, B, Zheng, D (2021). Robust integration of multiple single-cell RNA sequencing datasets using a single reference space. Nat Biotechnol, 39, 7:877-884.
- **DoubletFinder**: McGinnis, CS, Murrow, LM, Gartner, ZJ (2019). DoubletFinder: Doublet Detection in Single-Cell RNA Sequencing Data Using Artificial Nearest Neighbors. Cell Syst, 8, 4:329-337.e4.
- **edgeR**: Robinson, MD, McCarthy, DJ, Smyth, GK (2010). edgeR: a Bioconductor package for differential expression analysis of digital gene expression data. Bioinformatics, 26, 1:139-40.
- **velocyto**: La Manno, G, Soldatov, R, Zeisel, A, Braun, E, Hochgerner, H, Petukhov, V, Lidschreiber, K, Kastriti, ME, nnerberg, P, Furlan, A, Fan, J, Borm, LE, Liu, Z, van Bruggen, D, Guo, J, He, X, Barker, R, m, E, Castelo-Branco, G, Cramer, P, Adameyko, I, Linnarsson, S, Kharchenko, PV (2018). RNA velocity of single cells. Nature, 560, 7719:494-498.
- **scVelo**: Bergen, V, Lange, M, Peidli, S, Wolf, FA, Theis, FJ (2020). Generalizing RNA velocity to transient cell states through dynamical modeling. Nat Biotechnol, 38, 12:1408-1414.

